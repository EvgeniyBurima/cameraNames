<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Names</title>
    <style>
        body {
            background-color: antiquewhite;
        }
        .wrapper {
            padding: 8px;
        }
        ul {
            padding: 8px;
            border-top: 2px solid darkgrey;
            border-bottom: 2px solid darkgrey;
        }
        li {
            list-style-type: none;
            font-size: 1.1rem;
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <h2>Cameras:</h2>
        <div id="list-container"></div>
    </div>

    <script>
        const container = document.getElementById('list-container');
        /**
         * all available cameras
         */
        const cameraObjects = [];

        const stopTrack = (mediaStream) => {
            mediaStream.getTracks().forEach((track) => {
                track.stop();
                mediaStream.removeTrack(track);
            });
        };

        const backCameraKeywords = [
            'rear',
            'back',
            'rück',
            'arrière',
            'trasera',
            'trás',
            'traseira',
            'posteriore',
            '后面',
            '後面',
            '背面',
            '后置',
            '後置',
            '背置',
            'задней',
            'الخلفية',
            '후',
            'arka',
            'achterzijde',
            'หลัง',
            'baksidan',
            'bagside',
            'sau',
            'bak',
            'tylny',
            'takakamera',
            'belakang',
            'אחורית',
            'πίσω',
            'spate',
            'hátsó',
            'zadní',
            'darrere',
            'zadná',
            'задня',
            'stražnja',
            'belakang',
            'बैक',
        ];

        const isBackCameraLabel = (cameraLabel) => {
            const lowerCameraLabel = cameraLabel.toLowerCase();
            return backCameraKeywords.some(
                (backCameraKeyword) => lowerCameraLabel.includes(backCameraKeyword),
            );
        };

        const fillVideoDevices = async () => {
            try {
                let devices = await navigator.mediaDevices.enumerateDevices();
                // if permission is not given, label of video devices will be empty string
                const isPermissionNotGranted = devices
                    .filter(({ kind }) => kind.toLowerCase().startsWith('video')) // filter only video devices
                    .every(({ label }) => label === '');
                if (isPermissionNotGranted) {
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: true,
                        audio: false,
                    });
                    // enumerate devices again - now the label field should be non-empty,
                    // as we have a stream active (even if we didn't get persistent permission for camera)
                    devices = await navigator.mediaDevices.enumerateDevices();
                    stopTrack(stream);
                }

                devices
                    .filter(({ kind }) => kind.toLowerCase().startsWith('video'))
                    .forEach((videoDevice) => {
                        const label = videoDevice.label || '';
                        // eslint-disable-next-line no-param-reassign
                        videoDevice.cameraType = isBackCameraLabel(label)
                            ? 'environment'
                            : 'user';
                        if (label) {
                            cameraObjects.push(videoDevice);
                        }
                    });
                return cameraObjects;
            } catch (error) {
                return errorHandler(error);
            }
        };

        const createLi = (name, val) => {
            const li = document.createElement('li');
            const b = document.createElement('b');
            b.textContent = `${name}: `
            const span = document.createElement('span');
            span.textContent = val;
            li.append(b, span);
            return li
        };

        const addPre = ({ cameraType, label }) => {
            const typeLi = createLi('type', cameraType);
            const labelLi = createLi('label', label);
            const list = document.createElement('ul');
            list.append(typeLi, labelLi);
            container.append(list);
            
            
        }

        const selectCamera = async () => {
            if (!cameraObjects.length) {
                await fillVideoDevices();
            }
            if (!cameraObjects.length) {
                return false;
            }

            cameraObjects.forEach(addPre)
        };

        selectCamera();
    </script>
</body>

</html>