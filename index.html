<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Names</title>
    <style>
        body {
            background-color: antiquewhite;
        }
        .wrapper {
            padding: 8px;
        }
        ul {
            padding: 8px;
            border-top: 2px solid darkgrey;
            border-bottom: 2px solid darkgrey;
        }
        li {
            list-style-type: none;
            font-size: 1.1rem;
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <h2>Cameras:</h2>
        <div id="list-container"></div>
    </div>

    <script>
        const container = document.getElementById('list-container');
        /**
         * all available cameras
         */
        const cameraObjects = [];

        const stopTrack = (mediaStream) => {
            mediaStream.getTracks().forEach((track) => {
                track.stop();
                mediaStream.removeTrack(track);
            });
        };

        const getCameras = async (facingMode) => {
            const stream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: facingMode },
                audio: false,
            });
            // enumerate devices again - now the label field should be non-empty,
            // as we have a stream active (even if we didn't get persistent permission for camera)
            const devices = await navigator.mediaDevices.enumerateDevices();
            stopTrack(stream);
            return devices.map((device) => ({ ...device, cameraType: facingMode }));
        };

        const fillVideoDevices = async () => {
            try {
                let devices = await navigator.mediaDevices.enumerateDevices();
                // if permission is not given, label of video devices will be empty string
                const isPermissionNotGranted = devices
                    .filter(({ kind }) => kind.toLowerCase().startsWith('video')) // filter only video devices
                    .every(({ label }) => label === '');
                if (isPermissionNotGranted) {
                    const facingModes = ['user', 'environment'];
                    devices = (await Promise.all(facingModes.map(getCameras))).flat();
                }

                devices
                    .filter(({ kind }) => kind.toLowerCase().startsWith('video'))
                    .forEach((videoDevice) => {
                        const label = videoDevice.label || '';
                        if (label) {
                            cameraObjects.push(videoDevice);
                        }
                    });
            } catch (error) {
                return errorHandler(error);
            }
        };

        const createLi = (name, val) => {
            const li = document.createElement('li');
            const b = document.createElement('b');
            b.textContent = `${name}: `
            const span = document.createElement('span');
            span.textContent = val;
            li.append(b, span);
            return li
        };

        const addPre = ({ cameraType, label }) => {
            const typeLi = createLi('type', cameraType);
            const labelLi = createLi('label', label);
            const list = document.createElement('ul');
            list.append(typeLi, labelLi);
            container.append(list);
            
            
        }

        const selectCamera = async () => {
            if (!cameraObjects.length) {
                await fillVideoDevices();
            }
            if (!cameraObjects.length) {
                return false;
            }

            cameraObjects.forEach(addPre)
        };

        selectCamera();
    </script>
</body>

</html>